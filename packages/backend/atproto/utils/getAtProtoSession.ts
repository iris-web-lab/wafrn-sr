import { Model } from 'sequelize'
import { environment } from '../../environment.js'
import { BskyAgent } from '@atproto/api'

async function getAtProtoSession(user?: Model<any, any>): Promise<BskyAgent> {
  const agent = new BskyAgent({
    service: 'https://' + environment.bskyPds
  })
  if (user) {
    await agent.login({
      identifier: user.url + '@' + environment.instanceUrl,
      // this is cursed BUTT its an autogenerated one. And the login endpoints are blocked too. so its safe-ish.
      password: user.bskyAuthData
    })
  }
  return agent
}

export { getAtProtoSession }
